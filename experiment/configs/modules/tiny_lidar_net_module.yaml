module:
  name: "tiny_lidar_net"

  # Define simulation rate as a reusable variable
  simulation_rate_hz: &simulation_rate_hz 100.0

  # All nodes in execution order
  nodes:
    # Simulator node with LiDAR enabled
    - name: "Simulator"
      type: "KinematicSimulator"
      rate_hz: *simulation_rate_hz
      params:
        map_path: "${system.map_path}"
        vehicle_params: "${system.vehicle_params}"
        initial_state:
          x: 89630.067
          y: 43130.695
          yaw: 2.2
          velocity: 0.0
        # 障害物設定（例）
        obstacles:
          - type: static
            shape:
              type: rectangle
              width: 2
              length: 4
            position:
              x: 89635.30304557543
              y: 43148.38126281431
              yaw: 0
          - type: static
            shape:
              type: rectangle
              width: 2
              length: 4
            position:
              x: 89642.36393471953
              y: 43156.66603941006
              yaw: 0
          - type: static
            shape:
              type: rectangle
              width: 2
              length: 4
            position:
              x: 89640.38688575919
              y: 43139.62576027563
              yaw: 0
          - type: static
            shape:
              type: rectangle
              width: 2
              length: 4
            position:
              x: 89639.82201462766
              y: 43149.416859888785
              yaw: 0
          - type: static
            shape:
              type: rectangle
              width: 2
              length: 4
            position:
              x: 89645.0
              y: 43132.0
              yaw: 0

    # Tiny LiDAR Net node (replaces Planning + Control)
    - name: "TinyLidarNet"
      type: "TinyLidarNetNode"
      rate_hz: 30.0
      params:
        vehicle_params: "${system.vehicle_params}"
        model_path: "ad_components/control/tiny_lidar_net/ckpt/tinylidarnet_weights.npy"
        input_dim: 1080
        output_dim: 2
        architecture: "large"
        max_range: 30.0
        control_mode: "ai"
        fixed_acceleration: 0.1

    # Supervisor node
    - name: "Supervisor"
      type: "SupervisorNode"
      rate_hz: *simulation_rate_hz
      params:
        # Goal-related termination condition
        goal:
          enabled: true             # Terminate simulation when goal is reached
          x: 89630.067              # Goal position X coordinate
          y: 43130.695              # Goal position Y coordinate
          radius: 5.0               # Goal radius threshold
          min_elapsed_time: 20.0    # Minimum time before goal detection starts

        # Off-track termination condition
        off_track:
          enabled: true              # Terminate simulation when vehicle goes off-track

        # Collision termination condition
        collision:
          enabled: true              # Terminate simulation when vehicle collides with obstacles

    # Logger node
    - name: "Logger"
      type: "LoggerNode"
      rate_hz: *simulation_rate_hz
      params:
        map_path: "${system.map_path}"
        vehicle_params: "${system.vehicle_params}"
